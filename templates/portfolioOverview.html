<!DOCTYPE html>
<html>
<head>
    <title>Candlestick Chart</title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
</head>
<body onload="updateChart()">

{% include 'base.html' %}

<div class="content">
  <div style="width:75%;">
      <canvas id="chart"></canvas>
  </div>
  <div style="width:25%;float:right;">
      <label for="symbol">Symbol:</label>
      <select id="symbol" name="symbol">
          {% for asset_name in asset_names %}
              <option value="{{ asset_name }}">{{ asset_name }}</option>
          {% endfor %}
      </select>
      <br>
      <label for="start">Start Date:</label>
      <input type="date" id="start" name="start">
      <br>
      <label for="end">End Date:</label>
      <input type="date" id="end" name="end">
      <br><br>
      <button onclick="updateChart()">Update Chart</button>
  </div>
</div>

<script>
  var ctx = document.getElementById('chart').getContext('2d');
  var chart = new Chart(ctx, {
      type: 'candlestick',
      data: {},
      options: {}
  });

  function updateChart() {
      var symbol = document.getElementById('symbol').value;
      var start = document.getElementById('start').value;
      var end = document.getElementById('end').value;

      fetch('/stock_data', {
          method: 'POST',
          body: JSON.stringify({symbol: symbol, start: start, end: end}),
          headers: {
              'Content-Type': 'application/json'
          }
      })
      .then(res => {
          if (!res.ok) {
              throw Error(res.statusText);
          }
          return res.json();
      })
      .then(data => {
          chart.data = data;
          chart.update();
      })
      .catch(error => {
          console.error(error);
          alert("Error retrieving data. Please try again later.");
      });
  }
</script>
</body>
</html>